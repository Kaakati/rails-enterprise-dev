---
name: reactree-init
description: |
  Initialize ReAcTree plugin in the current Rails project. Creates configuration,
  validates prerequisites, sets up working memory, and optionally copies bundled
  skills. Run this first when using the plugin in a new project.
allowed-tools: ["Bash", "Read", "Write", "Glob", "AskUserQuestion"]
---

# ReAcTree Plugin Initialization

You are initializing the ReAcTree plugin for this Rails project. Follow these steps systematically and provide clear feedback at each stage.

## Phase 1: Validate Plugin Installation

First, verify the plugin is properly installed:

```bash
# Check plugin directory exists
ls -la .claude/plugins/reactree-rails-dev/ 2>/dev/null

# Check hooks.json exists
cat .claude/plugins/reactree-rails-dev/hooks/hooks.json 2>/dev/null | head -5

# Check scripts are executable
ls -la .claude/plugins/reactree-rails-dev/hooks/scripts/*.sh 2>/dev/null
```

**Expected**: Plugin directory with hooks.json and executable scripts.

**If missing**: Report error - plugin not installed correctly.

## Phase 2: Check Skills Directory

Check if the project has skills:

```bash
# Check skills directory
ls -la .claude/skills/ 2>/dev/null

# Count skill directories
find .claude/skills -maxdepth 1 -type d 2>/dev/null | wc -l
```

**If `.claude/skills/` exists with skills**: Scan and categorize them.

**If `.claude/skills/` is empty or missing**: Use AskUserQuestion to offer options:

```
The plugin includes 18 bundled skills for Rails development.
Would you like to copy them to your project?

Options:
  [1] Copy all bundled skills (Recommended)
      - activerecord-patterns, service-object-patterns, hotwire-patterns
      - rspec-testing-patterns, rails-conventions, rails-error-prevention
      - viewcomponents-specialist, sidekiq-async-patterns, and 10 more

  [2] Copy only core skills (3 skills)
      - rails-conventions, rails-error-prevention, codebase-inspection

  [3] Skip - I'll add skills manually later
```

### Copy Skills (if user chooses option 1 or 2)

**Option 1 - All skills**:
```bash
mkdir -p .claude/skills
cp -r .claude/plugins/reactree-rails-dev/skills/* .claude/skills/
```

**Option 2 - Core skills only**:
```bash
mkdir -p .claude/skills
cp -r .claude/plugins/reactree-rails-dev/skills/rails-conventions .claude/skills/
cp -r .claude/plugins/reactree-rails-dev/skills/rails-error-prevention .claude/skills/
cp -r .claude/plugins/reactree-rails-dev/skills/codebase-inspection .claude/skills/
```

## Phase 3: Generate Configuration File

Create or update `.claude/reactree-rails-dev.local.md`:

```markdown
---
smart_detection_enabled: true
detection_mode: suggest
annoyance_threshold: medium
---

# ReAcTree Configuration

This file was generated by `/reactree-init`.

## Settings

- **smart_detection_enabled**: Enable auto-triggering based on prompt analysis
- **detection_mode**: `suggest` (show suggestions) | `inject` (auto-activate) | `disabled`
- **annoyance_threshold**: `low` (minimal triggers) | `medium` | `high` (frequent triggers)

## Available Skills

<!-- Auto-populated by skill discovery -->
```

Then scan and categorize skills:

```bash
# Scan skills and categorize
for skill_dir in .claude/skills/*/; do
  skill_name=$(basename "$skill_dir")
  echo "Found skill: $skill_name"
done
```

Categorize skills into:
- **Core**: rails-conventions, rails-error-prevention, codebase-inspection, rails-context-verification
- **Data**: activerecord-patterns
- **Service**: service-object-patterns, sidekiq-async-patterns, api-development-patterns
- **UI**: hotwire-patterns, viewcomponents-specialist, tailadmin-patterns
- **Testing**: rspec-testing-patterns
- **Domain**: localization, requirements-writing, ruby-oop-patterns
- **Plugin**: reactree-patterns, smart-detection, skill-discovery, workflow-orchestration, beads-integration

## Phase 4: Initialize Memory Files

Create memory files if they don't exist:

```bash
# Working memory
if [ ! -f .claude/reactree-memory.jsonl ]; then
  touch .claude/reactree-memory.jsonl
  echo '{"initialized": true, "timestamp": "'$(date -Iseconds)'"}' >> .claude/reactree-memory.jsonl
fi

# Episodic memory
if [ ! -f .claude/reactree-episodes.jsonl ]; then
  touch .claude/reactree-episodes.jsonl
fi

# Feedback state
if [ ! -f .claude/reactree-feedback.jsonl ]; then
  touch .claude/reactree-feedback.jsonl
fi

# Control flow state
if [ ! -f .claude/reactree-state.jsonl ]; then
  touch .claude/reactree-state.jsonl
fi
```

## Phase 5: Status Report

After completing all phases, output a comprehensive status report:

```
ğŸš€ ReAcTree Plugin Initialized!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Prerequisites:
  âœ… Plugin installed at .claude/plugins/reactree-rails-dev/
  âœ… Hooks configured (SessionStart, UserPromptSubmit)
  âœ… Scripts executable

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Skills Discovered (X total):
  ğŸ“¦ Core: [list skills]
  ğŸ’¾ Data: [list skills]
  âš™ï¸ Service: [list skills]
  ğŸ¨ UI: [list skills]
  ğŸ§ª Testing: [list skills]
  ğŸŒ Domain: [list skills]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Configuration:
  âœ… Config file: .claude/reactree-rails-dev.local.md
  ğŸ“Š Smart Detection: ENABLED (suggest mode)
  ğŸšï¸ Annoyance Threshold: medium

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Memory Initialized:
  âœ… Working memory: .claude/reactree-memory.jsonl
  âœ… Episodic memory: .claude/reactree-episodes.jsonl
  âœ… Feedback state: .claude/reactree-feedback.jsonl
  âœ… Control flow state: .claude/reactree-state.jsonl

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Available Commands:
  /reactree-dev      - Full development workflow with parallel execution
  /reactree-feature  - Feature-driven development with user stories
  /reactree-debug    - Systematic debugging workflow
  /reactree-refactor - Safe refactoring with test preservation

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Auto-Triggering Examples:
  "Add user authentication"     â†’ suggests /reactree-dev
  "Fix the payment bug"         â†’ suggests /reactree-debug
  "Refactor the user service"   â†’ suggests /reactree-refactor
  "Find payment controller"     â†’ routes to file-finder agent

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Ready to use! Try one of the commands above or just describe what you want to build.
```

## Error Handling

If any phase fails, provide clear error messages:

### Plugin Not Installed
```
âŒ Plugin Not Found

The ReAcTree plugin is not installed at .claude/plugins/reactree-rails-dev/

To install:
  1. Clone the plugin repository
  2. Copy to your project:
     mkdir -p .claude/plugins
     cp -r /path/to/reactree-rails-dev .claude/plugins/
  3. Run /reactree-init again
```

### Hooks Not Configured
```
âš ï¸ Hooks Configuration Issue

hooks.json not found or invalid at:
  .claude/plugins/reactree-rails-dev/hooks/hooks.json

This may prevent auto-triggering from working.
The plugin will still work with manual /reactree-* commands.
```

### Scripts Not Executable
```
âš ï¸ Scripts Need Execute Permission

Run these commands to fix:
  chmod +x .claude/plugins/reactree-rails-dev/hooks/scripts/*.sh
```

## Idempotent Design

This command is safe to run multiple times:
- Existing config file is preserved (not overwritten)
- Memory files are created only if missing
- Skills are only copied if directory is empty
- Status report always shows current state
